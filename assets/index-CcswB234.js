var at=Object.defineProperty;var Q=a=>{throw TypeError(a)};var rt=(a,t,e)=>t in a?at(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var C=(a,t,e)=>rt(a,typeof t!="symbol"?t+"":t,e),z=(a,t,e)=>t.has(a)||Q("Cannot "+e);var N=(a,t,e)=>(z(a,t,"read from private field"),e?e.call(a):t.get(a)),M=(a,t,e)=>t.has(a)?Q("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(a):t.set(a,e),J=(a,t,e,s)=>(z(a,t,"write to private field"),s?s.call(a,e):t.set(a,e),e),A=(a,t,e)=>(z(a,t,"access private method"),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();const T={name:`
      __         ____            __               __      
     / / ___ _  / __/__ ____ _  / / ___ ____ ____/ / ___ _
    / /_/ _ \`/ / /__/ // /  ' \\/ _ / _ \`/ _ / __/ _ / _ \`/
   /____\\_,_/  \\___/\\_,_/_/_/_/_.__\\_,_/_//_\\__/_//_\\_,_/ 

`,sea:"\n  )`.\\  )`.   )`.   )`.   )`.   )`.   )`.   )`.   )`.   )`.\n-'   `-'   `-'   `-'   `-'   `-'   `-'   `-'   `-'   `-'   `-'\n",submarine:"\n                           |`-:_\n  ,----....____            |    `+.\n (             ````----....|___   |\n  \\     _                      ````----....____\n   \\    _)                                     ```---.._\n    \\                                                   \\\n  )`.\\  )`.   )`.   )`.   )`.   )`.   )`.   )`.   )`.   )`.\n-'   `-'   `-'   `-'   `-'   `-'   `-'   `-'   `-'   `-'   `-'\n",ship0:`
                                     |__
                                     |\\/
                                     ---
                                     / | [
                              !      | |||
                            _/|     _/|-++'
                        +  +--|    |--|--|_ |-
                     { /|__|  |/\\__|  |--- |||__/
                    +---------------___[}-_===_.'____         
                __\`-' ||___-{]_| _[}-  |     |_[___\\==--            _
__...__--==/___]_|__|_____________________________[___\\==--_,------' .7
\\                                                              MM-666/
 \\___________________________________________________________________|
`,ship1:`
                                     # #  { }
                                  ___#_#___|__
                              _  |____________|  _
                       _=====| | |            | | |==== _
                 =====| |.---------------------------. | |====
<-------------------'   .  .  .  .  .  .  .  .   '--------------/
 \\                                                             /
  \\_______________________________________________A42_________/
`,ship2:`
                       _____|\\
                  _.--| MM  |:
                 <____|.----||
                        .---''---,
                         ;..__..'    _...
                       ,'/  ;|/..--''    \\
                     ,'_/.-/':            :
                _..-'''/  /  |  \\    \\   _|/|
               \\      /-./_ \\;   \\    \\,;'   \\
               ,\\    / \\:  \`:\\    \\   //    \`:\`.
             ,'  \\  /-._;   | :    : ::    ,.   .
           ,'     ::   /\`-._| |    | || ' :  \`.\`.)
        _,'       |;._:: |  | |    | \`|   :    \`'
      ,'   \`.     /   |\`-:_ ; |    |  |  : \\
      \`--.   )   /|-._:    :          |   \\ \\
         /  /   :_|   ;\`-._;   __..--';    : :
        /  (    ;|;-./_  _/.-:'o |   /     ' |
       /  , \\._/_/_./--''/_|:|___|_,'        |
      :  /   \`'-'--'----'---------'          |
      | :     O ._O   O_. O ._O   O_.      ; ;
      : \`.      //    //    //    //     ,' /
    ~~~\`.______//____//____//____//_______,'~
              //    //~   //    //
       ~~   _//   _//   _// ~ _//     ~
     ~     / /   / /   / /   / /  ~      ~~
          ~~~   ~~~   ~~~   ~~~
`,ship3:`
--    .-""-.
   ) (     )
  (   )   (
     /     )
    (_    _)                     0_,-.__
      (_  )_                     |_.-._/
       (    )                    |_--..\\
        (__)                     |__--_/
     |''   \`\`\\                   |
     |        \\                  |      /b.
     |         \\  ,,,---===? \`\\  |  ,==y'
   ___,,,,,---==""\\        | ] \\ | ;|\\ |>
           _   _   \\   ___,| ,,---==""""bno,
    o  O  (_) (_)   \\ /          _     /XmX/
                     /         _(+)_   MM/
      \\@_,,,,,,---=="   \\      \\\\|//  MM/
--''''"                         ===  g/
                                    //
                                    ,'__________________________
   \\    \\    \\     \\               ,/~~~~~~~~~~~~~~~~~~~~~~~~~~~
                         _____    ,'  ~~~   .-""-.~~~~~~  .-""-.
      .-""-.           ///==---   /\`-._ ..-'      -.__..-'
            \`-.__..-' =====\\\\\\\\\\\\ V/  .---\\.
 MM=666               ~~~~~~~~~~~~, _',--/_.\\  .-""-.
                            .-""-.___\` --  \\|         -.__..-
`,ship4:`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~mm~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                                 o o
                                 o ooo
                                   o oo
                                      o o      |   #)
                                       oo     _|_|_#_                 
                                         o   | 666   |
    __                    ___________________|       |_________________
   |   -_______-----------                                              \\
  >|    _____                                                   --->     )
   |__ -     ---------_________________________________________________ /
`,ship5:`
                     _
                    | \\
                     '.|
     _-   _-    _-  _-||    _-    _-  _-   _-    _-    _-
       _-    _-   - __||___    _-       _-    _-    _-
    _-   _-    _-  |   _   |       _-   _-    _-
      _-    _-    /_) (_) (_\\        _-    _-       _-
              _.-'           \`-._      ________       _-
        _..--\`                   \`-..'       .'
    _.-'  o/o                     o/o\`-..__.'        ~  ~
 .-'      o|o                     o|o      \`.._.  // ~  ~
 \`-._     o|o                     o|o        |||<|||~  ~
     \`-.__o\\o                     o|o       .'-'  \\\\ ~  ~
          \`-.______________________\\_...-\`\`'.       ~  ~
                                    \`._______\`.
`,loser:`
                                     .
          ,d88b,                                     .                   __..-
          888888                                        .            .--MM666.
          \`?88P'         .                       __                ,'WWII::.
                                               .MW:\`-.            /WWII::..
                                       .    _.MWII:'. \`.     .  ,'WII::..
                                        _.-MWII::'.     \`-.   ,'WWI::.
    .                          _..vvvv,'WWII::'            \`.'WII::.
                            ,-'WI:'''/WII:'.                 \\WI:.
--------------------.==.--,'WWI:'.  /WI:'.          :.        \`.I:.
            -.      (88),'WWI:'.  ,'I:.              ::.        \\..
     -    ~-~_~ _./d88P/\\?I:'.   /WI:.                ::.        \\ .
          ~-~-,-~' ~~~ / )------'WI:.____ _.d88P_____::::.        \\
   _       ,-'  .     /</        __..--~~  ,P^'      ~~~~~~~~~~~~~~"""""""""""
\`?-._    ,' -   -   ,' !\\__..--~~  |  |   ,P'            -          _
  \\\`=~.~/     _    /--~~~\\  \\   \\  \\  \\ ,dP'   -   _           -         _
   \\ \\ \\ ~--.___.-'\\, \\  |\`. \`.  \`. \`.,dP' _            -
 - _\`.____....____  \`_____...---.._:dP'_ -  .  -              _
-_. -_ -  . _ - _ ~~~ . _  - _ -  _  _ -  -  .      -             -   .   -
   _   -  .   _   -  -    _     _       .      _             _         _
       -            -              _
`,winner:"\n                                           ///\\\n                                          |//-(\n                                        _.J.__/\n                                       /       `.\n                                    .-/          |\n                                  .-(-\\_/      `|'\n                               .-'_     |       |`-._\n                            .)''/ /`----F       |__ ``-.(_\n                         .-''|(--------/_____.-'.---`-._|_`--._\n                      .-''  J`----------------+'     \"Y\"\"\"\"F``-.`-.\n                   .-''      L .  .. . --'    Y      /.`-  F:.   `-`-._ . .  ..   ..  ...:::.....\n ..  . ..  .   .-'-'          \\         .. - ' \\    /\\ `. >           ``-.__    . ..\n'..   .   . .-'-'              \\  _ - \"     . ' `--'\\ .  v   :.           ``-``--._  .:::..'''':.\n  ...:::..-'.'                 _`-.      '     / | L \\ \\/                     `-.  `-::.::::':::..\n''''''   '' -                 - --`-. '    /  /  .    .'-                     _- ''''    '::::''\n                             - -- - -`--._ ___ /_|_.-'- --\n                             -  ---  ----  --  ---  --- - -\n                                 ------ --- ----- -- ----\n                               --  --- --------  -- ----\n                                          -- --   -\n\n"},P=class P{constructor(t){this.type=t,this.length=P.shipsAndSize[t],this.hits=0,this.sunk=!1}hit(){this.hits++,this.isSunk()}isSunk(){this.sunk=this.length===this.hits}};C(P,"shipsAndSize",{Carrier:5,Battleship:4,Cruiser:3,Submarine:3,Destroyer:2});let L=P;class w{constructor(){C(this,"shipsInventory",{available:Object.keys(L.shipsAndSize),placed:new Set,sank:new Set});this.ships=w.boardGenerator()}static boardGenerator(){return Array.from({length:10},()=>Array(10).fill(!1))}static fixSpace(t,e){return Math.max(0,Math.min(t,10-e))}getShips(){const t=this.shipsInventory.available.length,e=this.shipsInventory.available.shift(),s=L.shipsAndSize[e];return{shipsLeft:t,ship:e,size:s}}placeShip(t,e,s,n){const r=new L(n),o=s?w.fixSpace(t,r.length):t,_=s?e:w.fixSpace(e,r.length);for(let i=0;i<r.length;i++){const l=s?_:_+i,c=s?o+i:o;if(this.ships[l][c])return!1}for(let i=0;i<r.length;i++){const l=s?_:_+i,c=s?o+i:o;this.ships[l][c]=r}return this.shipsInventory.placed.add(n),!0}placeShipRandom(t){const e=Math.floor(Math.random()*10),s=Math.floor(Math.random()*10),n=!!Math.floor(Math.random()*2);return this.placeShip(e,s,n,t)||this.placeShipRandom(t),!0}placeRemainignShipsRandom(){for(const t of Object.keys(L.shipsAndSize))this.shipsInventory.placed.has(t)||this.placeShipRandom(t)}resetShips(){this.ships=w.boardGenerator(),this.shipsInventory.available=Object.keys(L.shipsAndSize),this.shipsInventory.placed=new Set}receiveAttack(t,e){const s=this.ships[e][t];return s&&typeof s!="object"?null:typeof s=="object"?(this.ships[e][t]="X",s.hit(),s.sunk?(this.shipsInventory.sank.add(s.type),this.shipsInventory.sank.size===5?"No ships left":"Sunk"):"Ship"):(this.ships[e][t]="~","Water")}}const q=document.querySelector("#app"),x=()=>{q.textContent=""},d=(a,t="",e="",s=void 0)=>{const n=document.createElement(a);return n.className=e,n.textContent=t,s&&n.setAttribute("data-cell",s),n},W=(a,t)=>{const e=d("label",a),s=document.createElement("input");return s.type="text",s.placeholder=t,e.append(s),e},ot=(a,t,e,s,n)=>{const r=d("label",a),o=document.createElement("input");return o.type="number",o.max=e,o.min=s,o.defaultValue=n,o.placeholder=t,r.append(o),r},y=(a,t="",e="")=>{const s=document.createElement("button");return s.type="button",s.className=t,s.textContent=a,e&&s.setAttribute("data-cell",e),s},tt=()=>{const a=d("div","","board");for(let t=0;t<11;t++){const e=t===0?"\\":String.fromCharCode(64+t),s=d("span",e,"board__coordenates");a.append(s)}return a},j=a=>{const t=tt();t.setAttribute("data-board","myShips");let e=1;return a.board.ships.flat().forEach((s,n)=>{const r=n%10,o=Math.floor(n/10);let _=s||"";const i=/\s|X/i.test(s)?"board__ships board__ships--occupied":"board__ships";r===0&&(t.append(d("span",e,"board__coordenates")),e++),typeof s=="object"&&(_=s.type.slice(0,2)),t.append(d("span",_,i,`${o}-${r}`))}),t},_t=()=>{const a=d("form"),t=W("Ingresa las coordenadas y presiona [Enter] para confirmar o, escribe <No sé> para ubicar aleatoriamente","<A-J> <1-10> <(H)orizontal/(V)ertical>");return a.append(t),a},it=(a,t)=>{const e=a.slice(0,2),s=d("div","","dialog__dock"),n=d("div","","dock__ship");n.draggable=!0;for(let l=0;l<t;l++){const c=d("div",e,"ship__section",l);n.append(c)}const r=d("div","","dialog__options"),o=y("Girar"),_=y("Ubicación aleatoria","","randomPosition");r.append(o,_),o.addEventListener("pointerdown",()=>{n.classList.toggle("dock__ship--vertical")}),s.append(n);const i=d("div","","dialog__drag");return i.append(s,r),i},U=(a,t,e,s,n)=>{const r=e?w.fixSpace(a,n):a,o=e?t:w.fixSpace(t,n);for(let _=0;_<n;_++){const i=e?r+_:r,l=e?o:o+_,c=document.querySelector(`[data-cell="${l}-${i}"]`);c.textContent?c.classList.add("board__ships--warn"):(c.setAttribute("data-current",!0),c.classList.add("board__ships--occupied"),c.textContent=`${s.slice(0,2)}`)}},X=()=>{document.querySelector("[data-current]")&&document.querySelectorAll("[data-current]").forEach(a=>{a.removeAttribute("data-current"),a.className="board__ships",a.textContent=""}),document.querySelectorAll(".board__ships--warn")&&document.querySelectorAll(".board__ships--warn").forEach(a=>{a.classList.remove("board__ships--warn")})},ct=(a,t,e=void 0)=>{x();const s=e?`${a.name}, ¿Quieres esta disposición para tu flota?`:`${a.name}, ubica tus barcos...`,n=d("header"),r=d("h1",s);n.append(r);const o=j(a),_=d("div","","settings");if(e){const i=y("No, volver a ubicar","set","reset"),l=y("Sí","","confirm");_.append(i,l)}else{const i=d("nav"),l=y("Coordenadas","","byInput"),c=y("Arrastrar y soltar","","byDragDrop");i.append(l,c);const{shipsLeft:h,ship:u,size:p}=t,m=d("div","","settings__dialog"),f=d("p",`${u} (${u.slice(0,2)}), quedan ${h} barcos por ubicar.`,"dialog__ship"),b=_t(),v=it(u,p);a.preferences.drag?b.classList.add("hidden"):v.classList.add("hidden"),m.append(f,b,v);const g=y("Reiniciar","","reset");_.append(i,m,g)}q.append(n,o,_)},dt=a=>{const t=tt();t.setAttribute("data-board","myAttacks");let e=1;return a.myAttacks.flat().forEach((s,n)=>{const r=n%10,o=Math.floor(n/10);if(r===0&&(t.append(d("span",e,"board__coordenates")),e++),s){let _="board__ships";s==="X"&&(_+=" board__ships--occupied"),t.append(d("span",s,_,`${o}-${r}`));return}t.append(y("","board__attack",`${o}-${r}`))}),t},lt=(a,t)=>{const[e,s]=a.split("-"),n=t==="Water"?"~":"X";let r="board__ships";r+=t==="Water"?" board__ships--occupied":" board__ships--warn";const o=d("span",n,r,a),_=document.querySelector(`[data-cell="${e}-${s}"]`);_.parentNode.replaceChild(o,_)},Y=a=>{const t=document.querySelector('[data-board="myShips"]'),e=document.querySelector('[data-board="myAttacks"]');t.classList.toggle("hidden",a!=="ships"),e.classList.toggle("hidden",a!=="attacks")},ut=(a,t)=>{const e=d("div","","radar"),s=d("div","","radar__sweep");a.preferences.radar||e.classList.add("hidden");const n=d("header"),r=d("h1",`¡${a.name}, es hora de atacar!`),o=a.preferences.radar?"Apagar el radar":"Encender el radar",_=y(o,"","radar"),i=d("div","","settings"),l=d("nav"),c=y("Ver mis disparos","","myAttacks"),h=y("Ver mis barcos","","myShips"),u=d("div","","settings__dialog"),p=d("span",`00:${String(t).padStart(2,"0")}`,"counter warn"),m=W("Escribe las coordenadas de tu ataque y presiona [Enter] para disparar:","<A-J> <1-10> / <Aleatorio/Random>"),f=y("¡Disparo automático!","set","attackRND"),b=dt(a),v=j(a);v.classList.add("hidden"),x(),e.append(s),n.append(r,_),l.append(c,h),u.append(p,m,f),i.append(u),q.append(e,n,l,b,v,i)},ht=a=>{const t=d("header"),e=d("h1",`¡${a.name}, te atacan!`),s=j(a);x(),t.append(e),q.append(t,s)},K=(a,t,e,s)=>{x();const n=6,r=Math.floor(Math.random()*n),o=`${t.name}, entrégale el dispositivo a ${e.name}`,_=a==="shipsPlacement"?`${e.name}, haz clic aquí o presiona [Enter] para ubicar tus barcos`:`${e.name}, haz clic aquí o presiona [Enter] para realizar tu ataque`,i=T[`ship${r}`];console.log(n,r);const l=c=>{c.type!=="pointerdown"&&c.key!=="Enter"||(document.removeEventListener("keydown",l),s(e))};q.append(d("p",o),d("pre",i),y(_)),document.querySelector("button").addEventListener("pointerdown",l),document.addEventListener("keydown",l)},R=(a,t=void 0)=>{x();const e=T[a],n=t?`Así se hace ${t.name}, ¿quieres jugar una nueva partida? (S)í / (N)o`:`${a==="winner"?"¡Ganaste!,":"Perdiste,"} ¿Una nueva partida? (S)í / (N)o`,r=o=>{const _=o.key.toLowerCase();_!=="s"&&_!=="n"||(document.body.removeEventListener("keydown",r),_==="s"?location.reload():_==="n"&&(window.location.href="https://cv.mmejia.com"))};q.append(d("pre",e),d("div",n)),document.body.addEventListener("keydown",r)};var E,D,S,et,st,$,nt;class Z{constructor(t=void 0){M(this,S);M(this,E);M(this,D,{Water:()=>{this.nextAttack.hits.length>1&&A(this,S,nt).call(this)},Ship:(t,e)=>{A(this,S,et).call(this,t,e)},Sunk:(t,e)=>{if(this.nextAttack.suspicious--,!this.nextAttack.suspicious)this.nextAttack.hits=[],this.nextAttack.queue=[];else{this.nextAttack.hits.push([e,t]);const[s,n]=A(this,S,$).call(this),r=[...new Set(this.nextAttack.queue.map(o=>o.join(",")))].map(o=>o.split(",").map(Number));this.nextAttack.hits=this.nextAttack.hits.filter(o=>o[s]!==n),this.nextAttack.queue=r.filter(o=>o[s]!==n)}}});this.board=new w,this.myAttacks=w.boardGenerator(),this.adversaryName=void 0,this.score=0,this.preferences={drag:!1,radar:!0},t?this.name=t:this.nextAttack={hits:[],queue:[],suspicious:0}}setAdversary(t){J(this,E,t),this.adversaryName=N(this,E).name??"AutoPlayer",t.adversaryName||t.setAdversary(this)}attack(t,e){if(t>9||e>9||this.myAttacks[e][t])return!1;const s=N(this,E).board.receiveAttack(t,e);return this.score=N(this,E).board.shipsInventory.sank.size,this.myAttacks[e][t]=s==="Water"?"~":"X",!this.name&&s!=="No ships left"&&N(this,D)[s](t,e),s}attackAuto(){var t;return!((t=this.nextAttack)!=null&&t.suspicious)||!this.nextAttack.queue?this.attackRandom():A(this,S,st).call(this)}getRandomCoordenates(){const t=this.myAttacks.flatMap((n,r)=>n.map((o,_)=>o?null:[r,_]).filter(o=>o)),[e,s]=t[Math.floor(Math.random()*t.length)];return{rCol:s,rRow:e}}attackRandom(){const{rCol:t,rRow:e}=this.getRandomCoordenates();return this.attack(t,e)}}E=new WeakMap,D=new WeakMap,S=new WeakSet,et=function(t,e){const n=[[-1,0],[0,1],[1,0],[0,-1]].map(([c,h])=>[e+c,t+h]).filter(([c,h])=>{var u;return((u=this.myAttacks[c])==null?void 0:u[h])===!1}),r=this.nextAttack;if(r.hits.push([e,t]),r.hits.length===1){r.queue=n,r.suspicious++;return}const[o,_]=A(this,S,$).call(this);r.hits.length===2&&r.queue.sort(c=>c[o]===_?-1:0);const[i,l]=n.reduce(([c,h],u)=>(u[o]===_?c.push(u):h.push(u),[c,h]),[[],[]]);r.queue.unshift(...i),r.queue.push(...l)},st=function(){const[t,e]=this.nextAttack.queue.shift();return this.attack(e,t)},$=function(){const t=this.nextAttack.hits,e=t[0][1]===t[t.length-1][1]?1:0,s=t[0][e];return[e,s]},nt=function(){const t=this.nextAttack.queue,[e,s]=A(this,S,$).call(this);t.filter(n=>n[e]===s).length||(this.nextAttack.suspicious=this.nextAttack.hits.length)};document.querySelector("#app");class pt{constructor(t,e,s){C(this,"activeCountdowns",[]);this.player1=new Z(t!==""?t:void 0),this.player2=new Z(e!==""?e:void 0),this.timerSec=+s,this.AttackDelaySec=.5,this.underAttackDelaySec=1,this.rndBaseMs=500,this.evalAttackFeedback=1.5,this.player1.setAdversary(this.player2)}dragNDropHandler(t,e,s){const n=document.querySelector(".dock__ship"),r=document.querySelectorAll(".ship__section"),o=document.querySelectorAll(".board__ships");let _,i;r.forEach(c=>{c.addEventListener("pointerdown",()=>{_=+c.getAttribute("data-cell")}),c.addEventListener("pointerup",()=>{_=void 0})});const l=(c,h)=>{if(!c)return;const[u,p]=c.split("-"),m=!document.querySelector(".dock__ship--vertical"),f=m?+p-+h:+p,b=m?+u:+u-+h;return{col:f,row:b,horizontal:m}};o.forEach(c=>{c.addEventListener("dragenter",()=>{X(),i=c.getAttribute("data-cell");const{col:h,row:u,horizontal:p}=l(i,_);U(h,u,p,e,s)})}),n.addEventListener("dragend",()=>{if(X(),!l(i,_))return;const{col:c,row:h,horizontal:u}=l(i,_);t.board.placeShip(c,h,u,e)&&this.setShips(t)})}setShips(t){if(!t.name){t.board.placeRemainignShipsRandom(),this.switcher("shipsPlacement",t);return}const e=t.board.shipsInventory.placed.size===5,{shipsLeft:s,ship:n,size:r}=t.board.getShips();if(ct(t,{shipsLeft:s,ship:n,size:r},e),document.querySelector('[data-cell="reset"]').addEventListener("pointerdown",()=>{t.board.resetShips(),this.setShips(t)}),e){document.querySelector('[data-cell="confirm"]').addEventListener("pointerdown",()=>{this.switcher("shipsPlacement",t)});return}const _=document.querySelector('[data-cell="byInput"]'),i=document.querySelector('[data-cell="byDragDrop"]'),l=document.querySelector("form"),c=document.querySelector(".dialog__drag"),h=document.querySelector("input"),u=document.querySelector('[data-cell="randomPosition"]');let p=null;_.addEventListener("pointerdown",()=>{c.classList.add("hidden"),l.classList.remove("hidden"),t.preferences.drag=!1}),i.addEventListener("pointerdown",()=>{c.classList.remove("hidden"),l.classList.add("hidden"),t.preferences.drag=!0}),u.addEventListener("pointerdown",()=>{t.board.placeShipRandom(n),this.setShips(t)}),this.dragNDropHandler(t,n,r),h.addEventListener("input",m=>{X();const f=m.target,b=f.value.match(/\bRRRRR\b/),v=f.value.match(/random|aleatorio|no s[eé]/i),g=f.value.match(/(10|[1-9])/),I=f.value.match(/\b[a-j]\b/i),O=f.value.match(/\b(hor|ver)/i);if(p=null,b){p="RRRRR";return}if(v){p="random";return}if(!g||!I||!O)return;const F=+g[0]-1,H=+I[0].toLowerCase().charCodeAt(0)-97,B=/hor/i.test(O[0]),G=B&&H+r>10?10-r:H,V=!B&&F+r>10?10-r:F;U(G,V,B,n,r),p=document.querySelector(".board__ships--warn")?null:{row:V,col:G,horizon:B,ship:n}}),h.addEventListener("keydown",m=>{if(m.key==="Enter"&&(m.preventDefault(),!!p)){if(p==="random")t.board.placeShipRandom(n);else if(p==="RRRRR")t.board.placeRemainignShipsRandom();else if(p.ship){const{col:f,row:b,horizon:v,ship:g}=p;t.board.placeShip(f,b,v,g)}this.setShips(t)}})}async receiveAttack(t,e){ht(t),document.body.classList.add("alarm");let s;do{s=e.attackAuto(),await this.delayActions(this.underAttackDelaySec,!0);const n=j(t),r=document.querySelector(".board");if(r.parentNode.replaceChild(n,r),await this.delayActions(this.evalAttackFeedback),s==="No ships left"){this.switcher("winner",e);return}}while(s!=="Water");document.body.classList.remove("alarm"),this.switcher("attack",e)}playerAttack(t){ut(t,this.timerSec),this.createCountdown(t);const e=document.querySelector('[data-cell="radar"]'),s=document.querySelector(".radar"),n=document.querySelector('[data-cell="myAttacks"]'),r=document.querySelector('[data-cell="myShips"]');e.addEventListener("pointerdown",()=>{t.preferences.radar=!t.preferences.radar,s.classList.toggle("hidden",t.preferences.radar===!1),e.textContent=s.classList.contains("hidden")?"Encender radar":"Apagar radar"}),n.addEventListener("pointerdown",()=>{Y("attacks")}),r.addEventListener("pointerdown",()=>{Y("ships")});const o=document.querySelectorAll(".board__attack"),_=document.querySelector('[data-cell="attackRND"]'),i=document.querySelector("input");let l=null;const c=async(h,u)=>{this.purgeCountdowns();const p=document.querySelectorAll("button"),m=t.attack(+u,+h),f=document.querySelector(`[data-cell="${h}-${u}"]`);p.forEach(b=>{b.disabled=!0}),await this.delayActions(this.AttackDelaySec),document.body.classList.toggle("alarm",m==="Ship"),lt(f.getAttribute("data-cell"),m),await this.delayActions(this.evalAttackFeedback),m==="Water"?this.switcher("attack",t):m==="No ships left"&&this.switcher("winner",t),p.forEach(b=>{b.disabled=!1}),i.value="",this.createCountdown(t)};o.forEach(h=>{h.addEventListener("pointerdown",u=>{u.target.classList.add("board__attack--aim");const[p,m]=h.getAttribute("data-cell").split("-");c(p,m)})}),_.addEventListener("pointerdown",()=>{const{rRow:h,rCol:u}=t.getRandomCoordenates();document.querySelector(`button[data-cell="${h}-${u}"]`).classList.add("board__attack--aim"),c(h,u)}),i.addEventListener("input",()=>{var v;l=null,(v=document.querySelector(".board__attack--aim"))==null||v.classList.remove("board__attack--aim");const h=i.value.match(/aleatorio|random/i),u=i.value.match(/[a-j]/i),p=i.value.match(/(10|[1-9])/);if(h){const{rRow:g,rCol:I}=t.getRandomCoordenates();document.querySelector(`button[data-cell="${g}-${I}"]`).classList.add("board__attack--aim"),l={row:g,col:I};return}if(!p||!u)return;const m=+p[0]-1,f=+u[0].toLowerCase().charCodeAt(0)-97,b=document.querySelector(`button[data-cell="${m}-${f}"]`);b&&(b.classList.add("board__attack--aim"),l={row:m,col:f})}),i.addEventListener("keydown",h=>{if(h.key!=="Enter"||!l)return;const{row:u,col:p}=l;c(u,p)})}delayActions(t){const e=t*1e3+Math.floor(Math.random()*this.rndBaseMs);return new Promise(s=>setTimeout(s,e))}purgeCountdowns(){this.activeCountdowns.forEach(clearInterval),this.activeCountdowns.length=0}countdown(t){return new Promise(e=>{let s=this.timerSec;const n=setInterval(()=>{s-=1,t(s),s<=0&&(clearInterval(n),e(s))},1e3);this.activeCountdowns.push(n)})}createCountdown(t){this.purgeCountdowns();const e=document.querySelector(".counter.warn");e&&(e.textContent=`00:${String(this.timerSec).padStart(2,"0")}`,this.countdown(s=>{e.textContent=`00:${String(s).padStart(2,"0")}`;const n=Math.max(this.timerSec/4,3);s<n&&document.body.classList.add("alarm")}).then(()=>{document.body.classList.remove("alarm"),this.switcher("attack",t)}))}switcher(t,e){const s=this.player1.name&&this.player2.name,n=this.player1.name&&!this.player2.name,r=!this.player1.name&&this.player2.name,o=e,_=e===this.player1?this.player2:this.player1;if(t==="shipsPlacement")if(s){const i=o===this.player1?this.setShips.bind(this):this.playerAttack.bind(this);K(t,o,_,i)}else n?o===this.player1?this.setShips(_):this.playerAttack(_):r&&(o===this.player2?this.receiveAttack(o,_):this.setShips(_));else t==="attack"?s?K(t,o,_,this.playerAttack.bind(this)):n?o===this.player1?this.receiveAttack(o,_):this.playerAttack(_):r&&(o===this.player1?this.playerAttack(_):this.receiveAttack(o,_)):t==="winner"&&(s?R("winner",o):n?o===this.player1?R("winner"):R("loser"):r&&(o===this.player1?R("loser"):R("winner")))}}const k=document.querySelector("#app"),mt=()=>{k.append(d("pre",T.submarine),d("pre",T.name),d("pre",T.sea),d("p","Presiona [Enter] o haz clic aquí para empezar..."));const a=t=>{(t.type==="pointerdown"||t.key==="Enter")&&(x(),k.removeEventListener("pointerdown",a),document.body.removeEventListener("keydown",a),ft())};k.addEventListener("pointerdown",a),document.body.addEventListener("keydown",a)},ft=()=>{k.append(d("p","Escribe el nombre de los jugadores o deja un espacio en blanco para jugar contra la computadora..."),W("¿Quién inicia el juego?","Nombre"),W("¿Quiés es el contrincante?","Nombre"),ot("¿Turnos de cuanto tiempo? (1-60 segundos)","<1-60>",1,60,15),y("¡Iniciar el encuentro!"));const a=t=>{if(t.type!=="pointerdown"&&t.key!=="Enter")return;const[e,s,n]=document.querySelectorAll("input");k.querySelectorAll(".warn").forEach(i=>i.remove());let o=!1;if(!e.value&&!s.value&&(k.insertBefore(d("h2","¡Debe haber al menos una persona!","warn"),k.querySelector("label")),o=!0),(isNaN(n.value)||+n.value<1||n.value>60)&&(k.insertBefore(d("h2","¡El timer sólo acepta números entre 1 y 60!","warn"),k.querySelector("label")),o=!0),o)return;document.body.removeEventListener("keydown",a);const _=new pt(e.value,s.value,+n.value);_.setShips(_.player1)};document.querySelector("button").addEventListener("pointerdown",a),document.body.addEventListener("keydown",a)};mt();
